name: ğŸš€ Windows Pro (Kami Tunnel)
on: 
  workflow_dispatch:
    inputs:
      win_version:
        description: 'ğŸ“€ Chá»n phiÃªn báº£n Windows'
        required: true
        default: '2022'
        type: choice
        options: ["2025", "2022", "2019", "2012", "11", "10"]

jobs:
  run-windows:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout Code
        uses: actions/checkout@v4

      - name: ğŸ—ï¸ Setup Windows Docker
        run: |
          cat <<EOF > docker-compose.yml
          version: "3.9"
          services:
            windows:
              image: dockurr/windows
              container_name: windows
              privileged: true
              environment:
                VERSION: "${{ github.event.inputs.win_version }}"
                USERNAME: "Zun"
                PASSWORD: "123456"
                RAM_SIZE: "6G"
                CPU_CORES: "2"
                DISK_SIZE: "60G"
                KVM: "Y"
              devices: [ "/dev/kvm:/dev/kvm" ]
              cap_add: [ "NET_ADMIN", "SYS_ADMIN" ]
              ports:
                - "8006:8006"
                - "3389:3389"
              restart: always
          EOF
          docker compose up -d

      - name: ğŸŒ Khá»Ÿi táº¡o Kami Tunnel (RDP & Web)
        run: |
          # Táº£i vÃ  giáº£i nÃ©n Kami Tunnel
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz
          chmod +x kami-tunnel

          # Cháº¡y Tunnel cho RDP (3389)
          ./kami-tunnel 3389 > /dev/null 2>&1 &
          sleep 5
          RDP_IP=$(cat kami_tunnel.txt)

          # Cháº¡y Tunnel cho Web (8006)
          ./kami-tunnel 8006 > /dev/null 2>&1 &
          sleep 5
          WEB_IP=$(cat kami_tunnel.txt)

          echo "===================================================="
          echo "ğŸš€ WINDOWS ${{ github.event.inputs.win_version }} ÄANG KHá»I CHáº Y!"
          echo "===================================================="
          echo "ğŸ–¥ï¸  Káº¾T Ná»I RDP: $RDP_IP"
          echo "ğŸŒ Káº¾T Ná»I WEB: http://$WEB_IP"
          echo "----------------------------------------------------"
          echo "ğŸ”‘ Username: Zun | Password: 123456"
          echo "â³ LÆ°u Ã½: Windows cáº§n 5-10 phÃºt Ä‘á»ƒ táº£i vÃ  cÃ i Ä‘áº·t."
          echo "===================================================="
          
          # Giá»¯ workflow cháº¡y vÃ  update log sáº¡ch sáº½
          for i in {1..72}; do
            echo "ğŸ’ [$(date +%H:%M:%S)] Tráº¡ng thÃ¡i: Äang hoáº¡t Ä‘á»™ng. RDP: $RDP_IP"
            sleep 300
          done
