name: ğŸš€ SEVER AI STV PREMIUM (FULL INFO LOG)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 360
    
    steps:
      # 1. KHá»I Äá»˜NG (Giá»¯ style cá»§a báº¡n)
      - name: ğŸ¯ KHá»I Äá»˜NG Há»† THá»NG
        run: |
          Write-Host "ğŸ¤– AI STV PREMIUM RDP SERVER" -ForegroundColor Yellow
          Write-Host "âœ… Há»‡ thá»‘ng Ä‘Ã£ sáºµn sÃ ng!" -ForegroundColor Green

      # 2. Táº O USER ADMIN (window@123456)
      - name: ğŸ‘¤ THIáº¾T Láº¬P USER ADMIN
        run: |
          net user Admin window@123456 /add /expires:never /passwordchg:no
          net localgroup Administrators Admin /add
          net localgroup "Remote Desktop Users" Admin /add
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-3389" dir=in action=allow protocol=TCP localport=3389 profile=any

      # 3. CHáº Y Lá»†NH KAMI (CMD NATIVE)
      - name: ğŸŒ KÃCH HOáº T KAMI TUNNEL
        shell: cmd
        run: |
          curl -L -o kami-tunnel-windows-amd64.tar.gz https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-windows-amd64.tar.gz
          tar -xzf kami-tunnel-windows-amd64.tar.gz
          :: Cháº¡y lá»‡nh cá»§a báº¡n vÃ  Ä‘áº©y log ra file Ä‘á»ƒ láº¥y IP
          start /b kami-tunnel.exe 3389 > kami_log.txt 2>&1

      # 4. Má»¤C HIá»†N THÃ”NG TIN Äá»‚ Báº N COI (Dá»±a theo máº«u báº¡n Ä‘Æ°a)
      - name: ğŸ‰ THÃ”NG TIN Káº¾T Ná»I
        run: |
          Write-Host "ğŸ”„ Äang chá» láº¥y IP Public tá»« Kami..." -ForegroundColor Cyan
          Start-Sleep -Seconds 15
          $log = Get-Content "kami_log.txt" -ErrorAction SilentlyContinue
          $ip = ($log | Select-String -Pattern "Public: ([^\s]+)" | ForEach-Object { $_.Matches.Groups[1].Value })
          
          Write-Host "`nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”" -ForegroundColor Cyan
          Write-Host "â”‚              ğŸ‰ RDP ÄÃƒ Sáº´N SÃ€NG!                 â”‚" -ForegroundColor Cyan
          Write-Host "â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤" -ForegroundColor Cyan
          Write-Host "â”‚ ğŸŒ  Äá»‹a chá»‰ IP : $ip" -ForegroundColor Yellow
          Write-Host "â”‚ ğŸ‘¤  TÃ i khoáº£n  : Admin" -ForegroundColor White
          Write-Host "â”‚ ğŸ”  Máº­t kháº©u   : window@123456" -ForegroundColor White
          Write-Host "â”‚ ğŸ“  Port       : 3389" -ForegroundColor White
          Write-Host "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜`n" -ForegroundColor Cyan
          
          # Hiá»‡n thÃªm log chi tiáº¿t bÃªn dÆ°á»›i cho báº¡n xem
          Write-Host "--- CHI TIáº¾T LOG KAMI ---" -ForegroundColor Gray
          Get-Content "kami_log.txt" -Tail 10

      # 5. DUY TRÃŒ PHIÃŠN
      - name: â³ DUY TRÃŒ PHIÃŠN LÃ€M VIá»†C
        run: |
          $endTime = (Get-Date).AddMinutes(340)
          while ((Get-Date) -lt $endTime) {
              Write-Host "`rğŸ’ Há»‡ thá»‘ng Ä‘ang cháº¡y... CÃ²n láº¡i: $(($endTime - (Get-Date)).ToString('hh\:mm\:ss'))" -NoNewline -ForegroundColor Magenta
              Start-Sleep -Seconds 10
          }
