name: ğŸš€ SEVER AI STV PREMIUM (CMD NATIVE)

on:
  workflow_dispatch:
    inputs:
      duration:
        description: 'ğŸ• Thá»i gian sá»­ dá»¥ng'
        required: false
        default: '5h40m'
        type: choice
        options:
        - '1h'
        - '3h' 
        - '5h40m'

jobs:
  Premium-RDP-Setup:
    runs-on: windows-latest
    timeout-minutes: 360
    
    steps:
      # 1. Táº O USER ADMIN (window@123456)
      - name: ğŸ‘¤ THIáº¾T Láº¬P USER ADMIN
        run: |
          # DÃ¹ng máº­t kháº©u máº¡nh Ä‘á»ƒ khÃ´ng lá»—i Policy
          net user Admin window@123456 /add /expires:never /passwordchg:no
          net localgroup Administrators Admin /add
          net localgroup "Remote Desktop Users" Admin /add
          
          # Má»Ÿ cá»•ng RDP há»‡ thá»‘ng
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server' -Name "fDenyTSConnections" -Value 0 -Force
          Set-ItemProperty -Path 'HKLM:\System\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp' -Name "UserAuthentication" -Value 0 -Force
          netsh advfirewall firewall add rule name="RDP-3389" dir=in action=allow protocol=TCP localport=3389 profile=any

      # 2. CHáº Y KAMI TUNNEL (DÃ™NG ÄÃšNG Lá»†NH Báº N Gá»¬I)
      - name: ğŸŒ KÃCH HOáº T KAMI TUNNEL
        shell: cmd
        run: |
          echo ğŸŒ ÄANG Táº¢I KAMI...
          curl -L -o kami-tunnel-windows-amd64.tar.gz https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-windows-amd64.tar.gz
          
          echo ğŸš€ ÄANG CHáº Y Lá»†NH Cá»¦A Báº N...
          tar -xzf kami-tunnel-windows-amd64.tar.gz
          kami-tunnel.exe 3389
