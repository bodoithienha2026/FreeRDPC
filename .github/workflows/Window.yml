name: üöÄ Windows 

on: 
  workflow_dispatch:
    inputs:
      win_version:
        description: 'üìÄ Ch·ªçn phi√™n b·∫£n Windows'
        required: true
        default: '2022'
        type: choice
        options: ["2025", "2022", "2019", "2012", "11", "10"]

jobs:
  run-windows:
    runs-on: ubuntu-latest
    steps:
      - name: üõ†Ô∏è ƒêANG KH·ªûI T·∫†O WINDOWS SERVER 2025
        run: |
          # Ch·∫°y ·∫©n to√†n b·ªô qu√° tr√¨nh c√†i ƒë·∫∑t
          sudo apt-get update > /dev/null 2>&1
          cat <<EOF > docker-compose.yml
          version: "3.9"
          services:
            windows:
              image: dockurr/windows
              container_name: windows
              privileged: true
              environment:
                VERSION: "${{ github.event.inputs.win_version }}"
                USERNAME: "windows"
                PASSWORD: "window@123456"
                RAM_SIZE: "8G"
                CPU_CORES: "4"
                DISK_SIZE: "60G"
              devices: [ "/dev/kvm" ]
              ports:
                - "3389:3389"
          EOF
          docker compose up -d > /dev/null 2>&1
          
          # T·∫£i Kami Tunnel ·∫©n danh
          wget -q https://github.com/kami2k1/tunnel/releases/latest/download/kami-tunnel-linux-amd64.tar.gz
          tar -xzf kami-tunnel-linux-amd64.tar.gz > /dev/null 2>&1
          chmod +x kami-tunnel
          
          # Ch·∫°y ƒë√∫ng l·ªánh c·ªßa b·∫°n
          ./kami-tunnel 3389 > /dev/null 2>&1 &

      - name: üéâ TH√îNG TIN K·∫æT N·ªêI WINDOWS
        run: |
          echo "üîÑ ƒêang ki·ªÉm tra t√≠n hi·ªáu t·ª´ Windows Server 2025..."
          
          # V√≤ng l·∫∑p ch·ªù cho ƒë·∫øn khi c√≥ file IP
          while [ ! -f kami_tunnel.txt ]; do sleep 2; done
          
          # ƒê·ª£i file c√≥ n·ªôi dung IP
          RDP_IP=""
          while [ -z "$RDP_IP" ]; do
            RDP_IP=$(cat kami_tunnel.txt)
            sleep 2
          done

          echo ""
          echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
          echo "‚îÇ          üéâ WINDOWS SERVER 2025 READY!             ‚îÇ"
          echo "‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§"
          echo "‚îÇ üåê ƒê·ªãa ch·ªâ IP : $RDP_IP"
          echo "‚îÇ üë§ T√†i kho·∫£n  : windows"
          echo "‚îÇ üîê M·∫≠t kh·∫©u   : window@123456"
          echo "‚îÇ üìç C·ªïng RDP   : 3389"
          echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
          echo ""
          echo "KAMI_IP=$RDP_IP" >> $GITHUB_ENV

      - name: ‚è≥ DUY TR√å PHI√äN WINDOWS
        run: |
          # Gi·ªØ workflow ch·∫°y v√† update log ng·∫Øn g·ªçn
          for i in {1..72}; do
            echo "üíé [$(date +%H:%M:%S)] Windows Server 2025 ƒëang ch·∫°y. IP: $KAMI_IP"
            sleep 300
          done
